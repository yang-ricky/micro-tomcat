### Micro Tomcat 项目任务列表

以下是一个帮助实现 Micro Tomcat 的任务列表，分为三个阶段：基础阶段（构建核心功能）、中级阶段（引入规范与优化性能）、高级阶段（扩展功能与容错处理）。每个阶段提供明确的学习目标、任务说明和产出要求，帮助逐步构建和优化 Micro Tomcat。

---

### 基础阶段（核心功能构建）

**学习目标**：  
- [ ] 掌握 HTTP 协议的基本请求与响应机制  
- [ ] 理解 Java Socket 编程，实现基础 HTTP 服务  
- [ ] 构建最小化的 HTTP Server，支持静态资源的请求与响应

#### 任务1：搭建项目结构与环境  
- [x] 创建 Maven 项目，搭建基础目录结构：`src/main/java` 和 `webroot`  
- [x] 定义核心类：`HttpServer`（监听请求）、`Request`（解析请求）、`Response`（生成响应）  
**产出要求**：  
- [x] 项目目录清晰，`HttpServer` 能启动并监听 8080 端口  

#### 任务2：实现简单的 HTTP Server  
**场景**：支持返回静态文件  
- [x] 在 `HttpServer` 中创建 `ServerSocket`，监听端口并接受请求  
- [x] 解析客户端请求，提取 URI 并读取 `webroot` 目录下对应文件  
- [x] 返回静态文件内容，同时设置 HTTP 状态码、内容长度、Content-Type 等响应头  
**产出要求**：  
- [x] 浏览器访问 `http://localhost:8080/hello.txt`，能正确返回文件内容  
- [x] 控制台打印请求日志（URI、客户端 IP 等）  

#### 任务3：解析 HTTP 请求  
**场景**：提取 HTTP 方法和 URI  
- [x] 编写 `Request` 类解析请求头，提取 HTTP 方法（如 GET）和 URI  
- [x] 在 `Response` 类中根据文件存在与否返回 200 或 404  
**产出要求**：  
- [x] 在控制台正确打印解析出的 HTTP 方法和 URI  
- [x] 未找到文件时返回 404，且带有合规的响应头和错误消息  

#### 任务4：实现简单的并发支持  
**场景**：多客户端同时访问  
- [x] 使用 `ExecutorService` 为每个请求创建独立线程处理  
- [x] 确保多个客户端可以同时请求不同资源  
**产出要求**：  
- [x] 浏览器同时访问多个 URL，能够正确返回响应且无阻塞  

---

### 中级阶段（规范与性能优化）

**学习目标**：  
- [ ] 引入 Servlet 规范，支持动态资源请求  
- [ ] 提升性能，引入 Processor 池化和多线程支持  
- [ ] 学习分层架构设计，拆分模块职责

#### 任务5：引入 Servlet 支持  
**场景**：处理动态资源  
- [ ] 定义 `Servlet` 接口，包含 `service(Request, Response)` 方法  
- [ ] 在请求解析中根据 URI 判断静态或动态资源请求，动态资源请求调用对应 Servlet 的 `service` 方法生成响应  
- [ ] 使用 URLClassLoader 动态加载 Servlet 类  
**产出要求**：  
- [ ] 浏览器访问 `http://localhost:8080/servlet/HelloServlet`，正确返回动态内容  
- [ ] 在控制台记录 Servlet 加载和执行日志  

#### 任务6：模块化改造  
**场景**：拆分模块职责  
- [ ] 将请求监听与处理分离：实现 `Connector` 负责监听请求，`Processor` 负责处理请求  
- [ ] `Processor` 支持静态和动态资源分发  
**产出要求**：  
- [ ] 项目模块划分清晰，`Connector` 和 `Processor` 各司其职  
- [ ] 代码结构具有良好的可维护性  

#### 任务7：引入 Processor 池化  
**场景**：提升并发处理性能  
- [ ] 使用池化技术管理 Processor 对象，避免频繁创建和销毁  
- [ ] 限制 Processor 池大小，确保在高并发场景下资源不被耗尽  
**产出要求**：  
- [ ] 支持至少 100 并发请求，正确返回响应且无明显性能下降  
- [ ] 输出性能测试结果（如每秒请求处理量）  

#### 任务8：优化线程管理  
**场景**：提升线程利用率  
- [ ] 为 Processor 引入线程池，实现多个线程同时处理不同请求  
- [ ] 使用 `wait/notify` 机制实现 Processor 和 Connector 的同步  
**产出要求**：  
- [ ] 多线程支持稳定，能够在高并发场景下无死锁和性能问题  

#### 任务9：实现 Session 管理  
**场景**：支持用户会话管理  
- [ ] 实现 `Session` 类，支持属性的存取  
- [ ] 使用 Cookie 或 URL 重写实现 Session ID 的传递  
- [ ] 实现 Session 超时机制和定期清理  
- [ ] 在 Request 和 Response 中添加 Session 相关方法  
**产出要求**：  
- [ ] 能够正确创建、获取和维护用户 Session  
- [ ] Session 在超时后自动失效并被清理  
- [ ] 提供示例 Servlet 演示 Session 的使用（如简单的登录状态维护）  

---

### 高级阶段（扩展功能与容错处理）

**学习目标**：  
- [ ] 支持多应用部署和配置管理  
- [ ] 实现容错处理，支持异常捕获和友好错误页面  
- [ ] 提升可扩展性，支持高级特性如 HTTPS 和配置文件解析

#### 任务10：多应用支持  
**场景**：支持多个 Web 应用  
- [ ] 在 `webroot` 目录下创建多个子目录，分别存放不同应用的静态资源和 Servlet 类  
- [ ] 使用 `Context` 管理每个应用的资源，确保应用之间隔离  
**产出要求**：  
- [ ] 能同时访问多个应用的资源，资源路径如 `/app1/hello.txt` 或 `/app2/servlet/HelloServlet`  
- [ ] 在控制台打印每个请求的应用名称和 URI  

#### 任务11：引入配置文件支持  
**场景**：通过配置文件管理应用和服务  
- [ ] 使用 `web.xml` 定义 Servlet 映射、初始化参数等  
- [ ] 解析 `web.xml` 文件，在启动时加载配置  
**产出要求**：  
- [ ] 能根据 `web.xml` 的配置加载 Servlet 和路由规则  
- [ ] 输出配置加载日志，确保配置文件错误时提示清晰  

#### 任务12：支持 HTTPS  
**场景**：为通信加密  
- [ ] 使用 Java 的 SSL/TLS 支持，实现 HTTPS 服务  
- [ ] 配置自签名证书，确保浏览器能通过 HTTPS 访问资源  
**产出要求**：  
- [ ] 浏览器访问 `https://localhost:8443/hello.txt` 能正确返回内容  
- [ ] 控制台输出 HTTPS 请求的详细日志  

#### 任务13：容错处理与友好错误页面  
**场景**：处理异常和错误  
- [ ] 捕获处理过程中可能出现的异常（如文件未找到、Servlet 加载失败）  
- [ ] 提供友好的错误页面，显示错误原因和建议  
**产出要求**：  
- [ ] 返回的错误页面具有详细的错误描述和联系方式  
- [ ] 输出异常日志，便于调试和分析  

---

### 附加任务（可选）

- **支持非阻塞 IO**：引入 NIO，支持更高并发处理能力  
- **性能调优**：使用简单的性能测试工具统计吞吐量和延迟（如 JMH 或自定义工具）  
- **集成 MicroSpring**：在 MicroTomcat 中运行一个简单的 Spring 应用  

通过以上任务列表，您将逐步完成从简单到复杂的 Micro Tomcat 实现，并在过程中学习核心技术点和设计模式，为深入理解 Web 服务器的实现和优化打下坚实基础。